%info
Set the number of combined hardware queues (RSS queues) for a network device.

Uses ethtool -L to configure the number of combined queues. If the device
already has the requested number of queues, no change is made.

Variables:
  N   - Number of combined queues to set (default: 1)
  NIC - NIC index to configure (default: 0)

Usage:
  %import@dut dev_channels N=4

%variables
N=1
NIC=0

%script sudo=true autokill=false name=dev_channel
n=$(sudo ethtool -l ${self:$NIC:ifname} | grep -i combined | tail -n 1 | grep -oE "[0-9]+")
if [ "$n" != "$N" ] ; then
    ethtool -L ${self:$NIC:ifname} combined $N && exit 0
else
    echo "Already have $n queues"
    exit 0
fi
exit 1
